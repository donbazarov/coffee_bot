diff --git a/bot/database/checklist_operations.py b/bot/database/checklist_operations.py
index 57654775180e5c86d1988744ef248a104de9b15b..cafa30bd60fddd40c04f4cf3f9915fb91d66667a 100644
--- a/bot/database/checklist_operations.py
+++ b/bot/database/checklist_operations.py
@@ -77,79 +77,82 @@ def delete_checklist_template(template_id: int) -> bool:
     """–£–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω —á–µ–∫-–ª–∏—Å—Ç–∞ (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)"""
     db = SessionLocal()
     try:
         template = db.query(ChecklistTemplate).filter(ChecklistTemplate.id == template_id).first()
         if not template:
             return False
         
         template.is_active = 0
         template.updated_at = datetime.utcnow()
         db.commit()
         logger.info(f"–®–∞–±–ª–æ–Ω —á–µ–∫-–ª–∏—Å—Ç–∞ ID {template_id} –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω")
         return True
     except Exception as e:
         db.rollback()
         logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —à–∞–±–ª–æ–Ω–∞ —á–µ–∫-–ª–∏—Å—Ç–∞: {e}")
         raise
     finally:
         db.close()
 
 def get_current_shift_for_user(user_id: int) -> Optional[Dict]:
     """–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å–º–µ–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —É—á–µ—Ç–æ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ–∫–Ω–∞ (+-1 —á–∞—Å)"""
     db = SessionLocal()
     try:
         now = datetime.now()
         today = now.date()
-        current_time = now.time()
         
         # –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
         user = db.query(User).filter(User.id == user_id).first()
         if not user or not user.iiko_id:
             return None
         
         # –ò—â–µ–º —Å–º–µ–Ω—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
         shifts = db.query(Schedule).join(ShiftType).filter(
             and_(
                 Schedule.iiko_id == str(user.iiko_id),
                 Schedule.shift_date == today
             )
         ).all()
         
         for shift in shifts:
             shift_type = shift.shift_type_obj
             if not shift_type:
                 continue
             
-            # –†–∞—Å—à–∏—Ä—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞ +-1 —á–∞—Å
             start_time = shift_type.start_time
             end_time = shift_type.end_time
             
-            # –°–æ–∑–¥–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞
-            start_window = (datetime.combine(today, start_time) - timedelta(hours=1)).time()
-            end_window = (datetime.combine(today, end_time) + timedelta(hours=1)).time()
+            start_dt = datetime.combine(today, start_time)
+            end_dt = datetime.combine(today, end_time)
             
-            if start_window <= current_time <= end_window:
+            if end_dt <= start_dt:
+                end_dt += timedelta(days=1)
+            
+            start_window = start_dt - timedelta(hours=1)
+            end_window = end_dt + timedelta(hours=1)
+            
+            if start_window <= now <= end_window:
                 return {
                     'shift': shift,
                     'shift_type': shift_type,
                     'day_of_week': today.weekday(),
                     'point': shift_type.point
                 }
         
         return None
     finally:
         db.close()
 
 def check_hybrid_shift_exists(point: str, shift_date: date) -> bool:
     """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –ø–µ—Ä–µ—Å–º–µ–Ω –Ω–∞ —Ç–æ—á–∫–µ –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∞—Ç—É"""
     db = SessionLocal()
     try:
         day_of_week = shift_date.weekday()
         
         # –ò—â–µ–º —Å–º–µ–Ω—ã —Ç–∏–ø–∞ 'hybrid' –Ω–∞ —ç—Ç—É –¥–∞—Ç—É –∏ —Ç–æ—á–∫—É
         hybrid_shifts = db.query(Schedule).join(ShiftType).filter(
             and_(
                 Schedule.shift_date == shift_date,
                 ShiftType.point == point,
                 ShiftType.shift_type == 'hybrid'
             )
         ).count()
@@ -342,26 +345,26 @@ def create_hybrid_assignment_with_tasks(day_of_week: int, morning_task_ids: List
         logger.info(f"–°–æ–∑–¥–∞–Ω–æ/–æ–±–Ω–æ–≤–ª–µ–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è {day_of_week} —Å {len(morning_task_ids)} —É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –∏ {len(evening_task_ids)} –≤–µ—á–µ—Ä–Ω–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏")
         return assignment
     except Exception as e:
         db.rollback()
         logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è: {e}")
         raise
     finally:
         db.close()
         
 def get_hybrid_assignment_tasks(assignment_id: int, shift_type: str = None) -> List[ChecklistTemplate]:
     """–ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á–∏ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è"""
     db = SessionLocal()
     try:
         from sqlalchemy.orm import joinedload
         
         query = db.query(HybridAssignmentTask).options(
             joinedload(HybridAssignmentTask.task)
         ).filter(HybridAssignmentTask.assignment_id == assignment_id)
         
         if shift_type:
             query = query.filter(HybridAssignmentTask.shift_type == shift_type)
         
         assignment_tasks = query.all()
         return [at.task for at in assignment_tasks if at.task]
     finally:
-        db.close()
\ No newline at end of file
+        db.close()
diff --git a/bot/database/checklist_stats_operations.py b/bot/database/checklist_stats_operations.py
index bd49cbd173f32a2ef47de575327471ecc650bd77..4b4bd2cbb48fb762cfed9d453f3b1f2bf89335c3 100644
--- a/bot/database/checklist_stats_operations.py
+++ b/bot/database/checklist_stats_operations.py
@@ -189,56 +189,54 @@ def _calculate_shift_type_stats(shifts: List[Schedule]) -> Dict:
             completion_rates.append(completion_rate)
     
     avg_completion = sum(completion_rates) / len(completion_rates) if completion_rates else 0
     
     return {
         'avg_completion': round(avg_completion, 1),
         'shift_count': len(shifts)
     }
 
 def get_task_stats(start_date: date, end_date: date, task_id: Optional[int] = None, point: Optional[str] = None) -> List[Dict]:
     """
     –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞–¥–∞–Ω–∏—è–º
     –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–∞–∂–¥–æ–º—É –∑–∞–¥–∞–Ω–∏—é –∏ —Ç–æ—á–∫–µ
     """
     db = SessionLocal()
     try:
         # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —à–∞–±–ª–æ–Ω—ã –∑–∞–¥–∞—á
         query = db.query(ChecklistTemplate).filter(ChecklistTemplate.is_active == 1)
         if task_id:
             query = query.filter(ChecklistTemplate.id == task_id)
         tasks = query.all()
         
         results = []
         
         for task in tasks:
-            # –î–ª—è –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–π –µ—Å—Ç—å —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ
-            points = [task.point] if point else ['–î–ï', '–£–Ø']
+            # –î–ª—è –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–π –Ω—É–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
+            points = [point] if point else ['–î–ï', '–£–Ø']
             
             for point_name in points:
-                if task.point != point_name:
-                    continue
                     
                 # –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Å–º–µ–Ω—ã, –≥–¥–µ —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã–ª–æ –±—ã—Ç—å
                 total_shifts_with_task = 0
                 completed_shifts_with_task = 0
                 
                 # –ò—â–µ–º —Å–º–µ–Ω—ã –∑–∞ –ø–µ—Ä–∏–æ–¥ –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –∏ –Ω–∞ —ç—Ç–æ–π —Ç–æ—á–∫–µ
                 shifts = db.query(Schedule).join(ShiftType).filter(
                     and_(
                         Schedule.shift_date >= start_date,
                         Schedule.shift_date <= end_date,
                         Schedule.is_active == True,
                         ShiftType.point == point_name,
                         extract('dow', Schedule.shift_date) == task.day_of_week
                     )
                 ).all()
                 
                 for shift in shifts:
                     shift_type_obj = shift.shift_type_obj
                     if not shift_type_obj:
                         continue
                     
                     # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Ö–æ–¥–∏—Ç –ª–∏ –∑–∞–¥–∞—á–∞ –≤ —á–µ–∫-–ª–∏—Å—Ç —ç—Ç–æ–π —Å–º–µ–Ω—ã
                     user = db.query(User).filter(User.iiko_id == shift.iiko_id).first()
                     if not user:
                         continue
@@ -278,90 +276,91 @@ def get_task_stats(start_date: date, end_date: date, task_id: Optional[int] = No
         return results
         
     finally:
         db.close()
 
 def get_detailed_log(target_date: date, point: str) -> List[Dict]:
     """
     –î–µ—Ç–∞–ª—å–Ω—ã–π –ª–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ–Ω—å –∏ —Ç–æ—á–∫—É
     –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–∂–¥–æ–º –∑–∞–¥–∞–Ω–∏–∏ –∏ –µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
     """
     db = SessionLocal()
     try:
         # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å–º–µ–Ω—ã –Ω–∞ —ç—Ç—É –¥–∞—Ç—É –∏ —Ç–æ—á–∫—É
         shifts = db.query(Schedule).join(ShiftType).filter(
             and_(
                 Schedule.shift_date == target_date,
                 ShiftType.point == point,
                 Schedule.is_active == True
             )
         ).all()
         
         if not shifts:
             return []
         
         # –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –≤—Å–µ—Ö —Å–º–µ–Ω —ç—Ç–æ–≥–æ –¥–Ω—è
-        all_tasks = set()
+        all_tasks = {}
         for shift in shifts:
             shift_type_obj = shift.shift_type_obj
             if not shift_type_obj:
                 continue
                 
             user = db.query(User).filter(User.iiko_id == shift.iiko_id).first()
             if not user:
                 continue
                 
             tasks = get_tasks_for_shift(
                 user.id,
                 shift.shift_date,
                 shift_type_obj.shift_type,
                 point
             )
-            all_tasks.update(tasks)
+            for task in tasks:
+                all_tasks[task.id] = task
         
         # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á
         completed_tasks = db.query(ChecklistLog).filter(
             and_(
                 ChecklistLog.shift_date == target_date,
                 ChecklistLog.point == point
             )
         ).all()
         
         # –°–æ–∑–¥–∞–µ–º mapping task_id -> completion info
         completion_info = {}
         for completed in completed_tasks:
             if completed.task_id not in completion_info:
                 completion_info[completed.task_id] = []
             completion_info[completed.task_id].append({
                 'completed_by': completed.completed_by.name if completed.completed_by else '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                 'completed_at': completed.completed_at.strftime('%H:%M') if completed.completed_at else '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'
             })
         
         # –§–æ—Ä–º–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
         results = []
-        for task in all_tasks:
+        for task in all_tasks.values():
             task_completions = completion_info.get(task.id, [])
             completed = len(task_completions) > 0
             
             results.append({
                 'task_id': task.id,
                 'task_description': task.task_description,
                 'completed': completed,
                 'completions': task_completions
             })
         
         return results
         
     finally:
         db.close()
 
 def get_weekday_name(weekday: int) -> str:
     """–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–Ω—è –Ω–µ–¥–µ–ª–∏ –ø–æ –Ω–æ–º–µ—Ä—É"""
     weekdays = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞', '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ']
     return weekdays[weekday]
 
 def format_stats_period(start_date: date, end_date: date) -> str:
     """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–∏–æ–¥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è"""
     if start_date == end_date:
         return start_date.strftime('%d.%m.%Y')
     else:
-        return f"{start_date.strftime('%d.%m.%Y')} - {end_date.strftime('%d.%m.%Y')}"
\ No newline at end of file
+        return f"{start_date.strftime('%d.%m.%Y')} - {end_date.strftime('%d.%m.%Y')}"
diff --git a/bot/database/schedule_operations.py b/bot/database/schedule_operations.py
index d76c91d22c1cbd662e2f9c521bb1a0d3a3920420..c8f8507de560a958d8b2f82cacce7c56bb536565 100644
--- a/bot/database/schedule_operations.py
+++ b/bot/database/schedule_operations.py
@@ -235,50 +235,85 @@ def delete_shifts_by_date_range(start_date: date, end_date: date) -> int:
     try:
         # –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ –±—É–¥—É—â–∏–µ —Å–º–µ–Ω—ã
         today = date.today()
         actual_start_date = max(start_date, today)
         
         if actual_start_date > end_date:
             logger.info("–ù–µ—Ç –±—É–¥—É—â–∏—Ö —Å–º–µ–Ω –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ")
             return 0
             
         deleted_count = db.query(Schedule).filter(
             and_(
                 Schedule.shift_date >= actual_start_date, 
                 Schedule.shift_date <= end_date
             )
         ).delete()
         db.commit()
         logger.info(f"–£–¥–∞–ª–µ–Ω–æ {deleted_count} –±—É–¥—É—â–∏—Ö —Å–º–µ–Ω –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ {actual_start_date} - {end_date}")
         return deleted_count
     except Exception as e:
         db.rollback()
         logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–º–µ–Ω: {e}")
         raise
     finally:
         db.close()
 
+def remove_stale_shifts(new_shifts: List[Dict], start_date: date, end_date: date) -> int:
+    """–£–¥–∞–ª–∏—Ç—å —Å–º–µ–Ω—ã, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –≤ –Ω–æ–≤–æ–º –Ω–∞–±–æ—Ä–µ –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –∏—Å—Ç–æ—á–Ω–∏–∫ sheets)."""
+    db = SessionLocal()
+    try:
+        new_keys = {
+            (shift['shift_date'], str(shift['iiko_id']), shift['shift_type_id'])
+            for shift in new_shifts
+        }
+        deleted_count = 0
+        existing_shifts = db.query(Schedule).filter(
+            and_(
+                Schedule.shift_date >= start_date,
+                Schedule.shift_date <= end_date
+            )
+        ).all()
+        
+        for shift in existing_shifts:
+            key = (shift.shift_date, str(shift.iiko_id), shift.shift_type_id)
+            if key in new_keys:
+                continue
+            if shift.source not in (None, 'sheets'):
+                continue
+            db.delete(shift)
+            deleted_count += 1
+        
+        db.commit()
+        logger.info(f"–£–¥–∞–ª–µ–Ω–æ {deleted_count} —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Å–º–µ–Ω –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ {start_date} - {end_date}")
+        return deleted_count
+    except Exception as e:
+        db.rollback()
+        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Å–º–µ–Ω: {e}")
+        raise
+    finally:
+        db.close()
+
 def get_all_shifts_for_user_in_range(iiko_id: str, start_date: date, end_date: date) -> List[Schedule]:
     """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–º–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –¥–∞—Ç"""
     return get_shifts_by_iiko_id(iiko_id, start_date=start_date, end_date=end_date)
 
 def create_shift_type(shift_type_data):
     """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø —Å–º–µ–Ω—ã"""
     db = SessionLocal()
     try:
         shift_type = ShiftType(
             name=shift_type_data['name'],
             start_time=shift_type_data['start_time'],
             end_time=shift_type_data['end_time'],
             point=shift_type_data['point'],
             shift_type=shift_type_data['shift_type']
         )
         db.add(shift_type)
         db.flush()
         shift_type_id = shift_type.id
         db.commit()
         return shift_type_id
     except Exception as e:
         db.rollback()
         raise e
     finally:
         db.close()
@@ -332,26 +367,26 @@ def delete_shift_type(shift_type_id):
     finally:
         db.close()
         
 def update_shift_iiko_id(shift_id: int, new_iiko_id: str) -> Optional[Schedule]:
     """–ò–∑–º–µ–Ω–∏—Ç—å iiko_id —Å–º–µ–Ω—ã (–¥–ª—è –∑–∞–º–µ–Ω) —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π"""
     db = SessionLocal()
     try:
         shift = db.query(Schedule).filter(Schedule.shift_id == shift_id).first()
         if not shift:
             return None
         
         # –õ–æ–≥–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ
         logger.info(f"–°–º–µ–Ω–∞ ID {shift_id}: {shift.iiko_id} -> {new_iiko_id}")
         
         shift.iiko_id = str(new_iiko_id)
         shift.updated_at = datetime.utcnow()
         db.commit()
         db.refresh(shift)
         logger.info(f"–°–º–µ–Ω–∞ ID {shift_id} –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ {new_iiko_id}")
         return shift
     except Exception as e:
         db.rollback()
         logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–º–µ–Ω—ã: {e}")
         raise
     finally:
-        db.close()
\ No newline at end of file
+        db.close()
diff --git a/bot/handlers/checklist.py b/bot/handlers/checklist.py
index 851c8ca682b018cda5ebd1a6bac0db0bc512a7b5..3cf96704109979b8d667782e8dda3e54de37d9ed 100644
--- a/bot/handlers/checklist.py
+++ b/bot/handlers/checklist.py
@@ -1,44 +1,58 @@
 """–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —á–µ–∫-–ª–∏—Å—Ç–æ–≤"""
 from telegram import Update, ReplyKeyboardMarkup, KeyboardButton, InlineKeyboardButton, InlineKeyboardMarkup
 from telegram.ext import ContextTypes, ConversationHandler, MessageHandler, filters, CommandHandler, CallbackQueryHandler
 from bot.utils.auth import require_roles, ROLE_MENTOR, ROLE_SENIOR
 from bot.utils.common_handlers import cancel_conversation, start_cancel_conversation
 from bot.database.user_operations import get_user_by_username
 from bot.database.checklist_operations import (
     get_current_shift_for_user, get_tasks_for_shift, get_completed_tasks_for_shift,
     mark_task_completed
 )
 from bot.keyboards.menus import get_main_menu
 from datetime import datetime, date
 import logging
 
 logger = logging.getLogger(__name__)
 
 # –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —á–µ–∫-–ª–∏—Å—Ç–æ–≤
 (CHECKLIST_MENU, CHECKLIST_VIEW, CHECKLIST_TASK_ACTION) = range(3)
 
+BUTTON_TASK_PREFIX_LENGTH = 20
+
+def format_task_button(task_description: str, completed: bool) -> str:
+    """–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–¥–∞—á–∏ —Å —É–∫–æ—Ä–æ—á–µ–Ω–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º."""
+    prefix = task_description[:BUTTON_TASK_PREFIX_LENGTH].rstrip()
+    if len(task_description) > BUTTON_TASK_PREFIX_LENGTH:
+        prefix = f"{prefix}‚Ä¶"
+    status = "‚úÖ" if completed else "‚òê"
+    return f"{status} {prefix}"
+
+def get_task_prefix(task_description: str) -> str:
+    """–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å –∑–∞–¥–∞—á–∏ –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è."""
+    return task_description[:BUTTON_TASK_PREFIX_LENGTH]
+
 async def checklist_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —á–µ–∫-–ª–∏—Å—Ç–∞"""
     user = update.effective_user
     
     # –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ telegram_username
     if not user.username:
         await update.message.reply_text(
             "‚ùå –£ –≤–∞—Å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω username –≤ Telegram.\n\n"
             "–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:\n"
             "1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å username –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Telegram\n"
             "2. –°–æ–æ–±—â–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –≤–∞—à–µ–π —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏"
         )
         return ConversationHandler.END
     
     db_user = get_user_by_username(user.username)
     
     if not db_user:
         await update.message.reply_text(
             f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{user.username} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ.\n\n"
             "–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n"
             "‚Ä¢ –í–∞—à username –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏\n"
             "‚Ä¢ –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è"
         )
         return ConversationHandler.END
     
@@ -65,167 +79,174 @@ async def checklist_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
     
     # –ü–æ–ª—É—á–∞–µ–º –∑–∞–¥–∞—á–∏ –¥–ª—è —Å–º–µ–Ω—ã
     tasks = get_tasks_for_shift(
         db_user.id, 
         shift_info['shift'].shift_date, 
         shift_info['shift_type'].shift_type, 
         shift_info['point']
     )
     
     if not tasks:
         await update.message.reply_text(
             f"üìù –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è {shift_info['shift_type'].name}\n\n"
             "–ù–∞ —ç—Ç—É —Å–º–µ–Ω—É –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ –∑–∞–¥–∞—á."
         )
         return ConversationHandler.END
     
     # –ü–æ–ª—É—á–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
     completed_tasks = get_completed_tasks_for_shift(
         shift_info['shift'].shift_date, 
         shift_info['point']
     )
     
     # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∑–∞–¥–∞—á–∞–º–∏
     keyboard = []
     for task in tasks:
-        status = "‚úÖ" if task.id in completed_tasks else "‚òê"
-        button_text = f"{status} {task.task_description}"
+        button_text = format_task_button(task.task_description, task.id in completed_tasks)
         keyboard.append([KeyboardButton(button_text)])
     
     keyboard.append([KeyboardButton("üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å")])
     keyboard.append([KeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥")])
     
     reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
     
     shift_type_names = {
         'morning': 'üåÖ –£—Ç—Ä–æ',
         'hybrid': 'üå§Ô∏è –ü–µ—Ä–µ—Å–º–µ–Ω', 
         'evening': 'üåÜ –í–µ—á–µ—Ä'
     }
     
     completion_count = len([t for t in tasks if t.id in completed_tasks])
     completion_percent = (completion_count / len(tasks)) * 100 if tasks else 0
     
+    tasks_text = "\n".join(
+        f"{'‚úÖ' if task.id in completed_tasks else '‚òê'} {task.task_description}"
+        for task in tasks
+    )
+    
     await update.message.reply_text(
         f"üìù –ß–µ–∫-–ª–∏—Å—Ç —Å–º–µ–Ω—ã\n\n"
         f"üìç –¢–æ—á–∫–∞: {shift_info['point']}\n"
         f"üïí –°–º–µ–Ω–∞: {shift_type_names.get(shift_info['shift_type'].shift_type, shift_info['shift_type'].shift_type)}\n"
         f"üìÖ –î–∞—Ç–∞: {shift_info['shift'].shift_date.strftime('%d.%m.%Y')}\n"
         f"üìä –ü—Ä–æ–≥—Ä–µ—Å—Å: {completion_count}/{len(tasks)} ({completion_percent:.0f}%)\n\n"
+        f"–ó–∞–¥–∞–Ω–∏—è:\n{tasks_text}\n\n"
         "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–∞–¥–∞—á—É —á—Ç–æ–±—ã –æ—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:",
         reply_markup=reply_markup
     )
     
     # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–º–µ–Ω–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
     context.user_data['current_shift'] = shift_info
     context.user_data['tasks'] = tasks
     context.user_data['user_id'] = db_user.id
     
     return CHECKLIST_VIEW
 
 async def handle_task_action(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏"""
     user = update.effective_user
     button_text = update.message.text
     
     # –ü–æ–ª—É—á–∞–µ–º user_id –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
     user_id = context.user_data.get('user_id')
     if not user_id:
         await update.message.reply_text("‚ùå –°–µ—Å—Å–∏—è —É—Å—Ç–∞—Ä–µ–ª–∞, –Ω–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ")
         return await checklist_menu(update, context)
     
     # –ò–∑–≤–ª–µ–∫–∞–µ–º ID –∑–∞–¥–∞—á–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏ (–∏—â–µ–º –∑–∞–¥–∞—á—É –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é)
     if not button_text.startswith(("‚úÖ", "‚òê")):
         await update.message.reply_text("‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ")
         return CHECKLIST_VIEW
     
     # –£–±–∏—Ä–∞–µ–º —ç–º–æ–¥–∑–∏ –∏ –ø—Ä–æ–±–µ–ª –∏–∑ –Ω–∞—á–∞–ª–∞
     task_description = button_text[2:]  # –£–±–∏—Ä–∞–µ–º "‚òê " –∏–ª–∏ "‚úÖ "
+    task_prefix = task_description[:BUTTON_TASK_PREFIX_LENGTH]
     
     # –ò—â–µ–º –∑–∞–¥–∞—á—É –≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–º —Å–ø–∏—Å–∫–µ
     tasks = context.user_data.get('tasks', [])
     task_to_mark = None
     for task in tasks:
-        if task.task_description == task_description:
+        if get_task_prefix(task.task_description) == task_prefix:
             task_to_mark = task
             break
     
     if not task_to_mark:
         await update.message.reply_text("‚ùå –ó–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
         return CHECKLIST_VIEW
     
     shift_info = context.user_data.get('current_shift')
     if not shift_info:
         await update.message.reply_text("‚ùå –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–º–µ–Ω–µ —É—Å—Ç–∞—Ä–µ–ª–∞")
         return await checklist_menu(update, context)
     
     # –û—Ç–º–µ—á–∞–µ–º –∑–∞–¥–∞—á—É –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é
     success = mark_task_completed(
         user_id,
         task_to_mark.id,
         shift_info['shift'].shift_date,
         shift_info['shift_type'].shift_type,
         shift_info['point']
     )
     
     if success:
-        await update.message.reply_text(f"‚úÖ –ó–∞–¥–∞—á–∞ –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è: {task_description}")
+        await update.message.reply_text(
+            f"‚úÖ –ó–∞–¥–∞—á–∞ –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è: {task_to_mark.task_description}"
+        )
         
         # –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
         tasks = get_tasks_for_shift(
             user_id, 
             shift_info['shift'].shift_date, 
             shift_info['shift_type'].shift_type, 
             shift_info['point']
         )
         completed_tasks = get_completed_tasks_for_shift(shift_info['shift'].shift_date, shift_info['point'])
         
         keyboard = []
         for task in tasks:
-            status = "‚úÖ" if task.id in completed_tasks else "‚òê"
-            button_text = f"{status} {task.task_description}"
+            button_text = format_task_button(task.task_description, task.id in completed_tasks)
             keyboard.append([KeyboardButton(button_text)])
         
         keyboard.append([KeyboardButton("üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å")])
         keyboard.append([KeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥")])
         
         reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
         
         completion_count = len([t for t in tasks if t.id in completed_tasks])
         completion_percent = (completion_count / len(tasks)) * 100 if tasks else 0
         
         await update.message.reply_text(
             f"üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω: {completion_count}/{len(tasks)} ({completion_percent:.0f}%)",
             reply_markup=reply_markup
         )
         
         # –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–¥–∞—á–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
         context.user_data['tasks'] = tasks
     else:
         await update.message.reply_text("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ—Ç–∫–µ –∑–∞–¥–∞—á–∏")
     
     return CHECKLIST_VIEW
 
 async def refresh_checklist(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —á–µ–∫-–ª–∏—Å—Ç–∞"""
     return await checklist_menu(update, context)
 
 def get_checklist_conversation_handler():
     """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç ConversationHandler –¥–ª—è —á–µ–∫-–ª–∏—Å—Ç–æ–≤"""
     return ConversationHandler(
         entry_points=[
             MessageHandler(filters.Regex("^üìù –ß–µ–∫-–ª–∏—Å—Ç —Å–º–µ–Ω—ã$"), checklist_menu)
         ],
         states={
             CHECKLIST_VIEW: [
                 MessageHandler(filters.Regex("^üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å$"), refresh_checklist),
                 MessageHandler(filters.Regex("^‚¨ÖÔ∏è –ù–∞–∑–∞–¥$"), cancel_conversation),
                 MessageHandler(filters.TEXT & ~filters.COMMAND, handle_task_action),
             ],
         },
         fallbacks=[
             CommandHandler("cancel", cancel_conversation),
             CommandHandler("start", start_cancel_conversation),
             MessageHandler(filters.Regex("^‚ùå –û—Ç–º–µ–Ω–∞$"), cancel_conversation),
         ],
         allow_reentry=True
-    )
\ No newline at end of file
+    )
diff --git a/bot/handlers/review.py b/bot/handlers/review.py
index 9aa960e78984c7c98296ce37e745a3f1240f7dab..5e248c66dcb423206bf8e6251001b39b736b06ec 100644
--- a/bot/handlers/review.py
+++ b/bot/handlers/review.py
@@ -1,436 +1,551 @@
 from telegram import Update, ReplyKeyboardMarkup, KeyboardButton
 from telegram.ext import ContextTypes, ConversationHandler, MessageHandler, filters, CommandHandler
 from bot.config import BotConfig
 from bot.database.simple_db import save_review
 from bot.database.user_operations import get_users_by_role
 from bot.keyboards.menus import get_main_menu
-from bot.utils.auth import is_mentor
+from bot.utils.auth import is_senior_or_mentor
 from bot.utils.common_handlers import cancel_conversation, start_cancel_conversation
 
 # –°–æ—Å—Ç–æ—è–Ω–∏—è - —Ä–∞—Å—à–∏—Ä—è–µ–º –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –æ—Ü–µ–Ω–∫–∏
 (SELECTING_BARISTA, SELECTING_POINT, SELECTING_CATEGORY,
  ESPRESSO_DRINK_TYPE, ESPRESSO_BALANCE, ESPRESSO_BOUQUET, ESPRESSO_BODY, ESPRESSO_AFTERTASTE, ESPRESSO_COMMENT,
  MILK_DRINK_TYPE, MILK_BALANCE, MILK_BOUQUET, MILK_FOAM, MILK_LATTE_ART, MILK_PHOTO, MILK_COMMENT) = range(16)
 
-# –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –æ—Ü–µ–Ω–æ–∫ 1-5 —Å –∫–Ω–æ–ø–∫–æ–π –æ—Ç–º–µ–Ω—ã
+# –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –æ—Ü–µ–Ω–æ–∫ 1-5 —Å –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∞–∑–∞–¥ –∏ –æ—Ç–º–µ–Ω—ã
+BACK_BUTTON = "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"
 rating_keyboard = [[str(i)] for i in range(1, 6)]
+rating_keyboard.append([BACK_BUTTON])
 rating_keyboard.append(["‚ùå –û—Ç–º–µ–Ω–∞"])
 rating_markup = ReplyKeyboardMarkup(rating_keyboard, resize_keyboard=True)
 
+async def prompt_point_selection(update: Update, context: ContextTypes.DEFAULT_TYPE):
+    """–ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±–æ—Ä —Ç–æ—á–∫–∏."""
+    barista_name = context.user_data.get('barista', '–ù–µ –≤—ã–±—Ä–∞–Ω')
+    keyboard = [[point] for point in BotConfig.points]
+    keyboard.append([BACK_BUTTON])
+    keyboard.append(["‚ùå –û—Ç–º–µ–Ω–∞"])
+    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
+    
+    await update.message.reply_text(
+        f"‚úÖ –ë–∞—Ä–∏—Å—Ç–∞: {barista_name}\n\n–¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—á–∫—É:",
+        reply_markup=reply_markup
+    )
+    return SELECTING_POINT
+
+async def prompt_category_selection(update: Update, context: ContextTypes.DEFAULT_TYPE):
+    """–ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞–ø–∏—Ç–∫–∞."""
+    point = context.user_data.get('point', '–ù–µ –≤—ã–±—Ä–∞–Ω–∞')
+    keyboard = [["–≠—Å–ø—Ä–µ—Å—Å–æ/–§–∏–ª—å—Ç—Ä"], ["–ú–æ–ª–æ—á–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫"]]
+    keyboard.append([BACK_BUTTON])
+    keyboard.append(["‚ùå –û—Ç–º–µ–Ω–∞"])
+    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
+    
+    await update.message.reply_text(
+        f"‚úÖ –¢–æ—á–∫–∞: {point}\n\n–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –Ω–∞–ø–∏—Ç–∫–∞:",
+        reply_markup=reply_markup
+    )
+    return SELECTING_CATEGORY
+
+async def prompt_espresso_drink_type(update: Update, context: ContextTypes.DEFAULT_TYPE):
+    """–ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±–æ—Ä —Ç–∏–ø–∞ —ç—Å–ø—Ä–µ—Å—Å–æ/—Ñ–∏–ª—å—Ç—Ä–∞."""
+    keyboard = [["–≠—Å–ø—Ä–µ—Å—Å–æ", "–§–∏–ª—å—Ç—Ä", "–ê–ª—å—Ç."], [BACK_BUTTON], ["‚ùå –û—Ç–º–µ–Ω–∞"]]
+    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
+    
+    await update.message.reply_text(
+        "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞–ø–∏—Ç–∫–∞:",
+        reply_markup=reply_markup
+    )
+    return ESPRESSO_DRINK_TYPE
+
+async def prompt_espresso_balance(update: Update, context: ContextTypes.DEFAULT_TYPE):
+    """–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ü–µ–Ω–∫—É –±–∞–ª–∞–Ω—Å–∞ —ç—Å–ø—Ä–µ—Å—Å–æ/—Ñ–∏–ª—å—Ç—Ä–∞."""
+    drink_type = context.user_data.get('drink_type', '')
+    await update.message.reply_text(
+        f"‚òï {drink_type}\n\n–û—Ü–µ–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –≤–∫—É—Å–∞ (1-5):\n"
+        "1 - –ù–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π\n5 - –ò–¥–µ–∞–ª—å–Ω–æ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π",
+        reply_markup=rating_markup
+    )
+    return ESPRESSO_BALANCE
+
+async def prompt_espresso_bouquet(update: Update, context: ContextTypes.DEFAULT_TYPE):
+    """–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ü–µ–Ω–∫—É –±—É–∫–µ—Ç–∞ —ç—Å–ø—Ä–µ—Å—Å–æ/—Ñ–∏–ª—å—Ç—Ä–∞."""
+    await update.message.reply_text(
+        "–û—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –±—É–∫–µ—Ç–∞ (1-5):\n"
+        "1 - –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ \n5 - –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
+        reply_markup=rating_markup
+    )
+    return ESPRESSO_BOUQUET
+
+async def prompt_espresso_body(update: Update, context: ContextTypes.DEFAULT_TYPE):
+    """–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ü–µ–Ω–∫—É —Ç–µ–ª–∞ —ç—Å–ø—Ä–µ—Å—Å–æ/—Ñ–∏–ª—å—Ç—Ä–∞."""
+    await update.message.reply_text(
+        "–û—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ç–µ–ª–∞ –Ω–∞–ø–∏—Ç–∫–∞ (1-5):\n"
+        "1 - –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ \n5 - –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
+        reply_markup=rating_markup
+    )
+    return ESPRESSO_BODY
+
+async def prompt_espresso_aftertaste(update: Update, context: ContextTypes.DEFAULT_TYPE):
+    """–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ü–µ–Ω–∫—É –ø–æ—Å–ª–µ–≤–∫—É—Å–∏—è —ç—Å–ø—Ä–µ—Å—Å–æ/—Ñ–∏–ª—å—Ç—Ä–∞."""
+    await update.message.reply_text(
+        "–û—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ—Å–ª–µ–≤–∫—É—Å–∏—è (1-5):\n"
+        "1 - –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ \n5 - –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
+        reply_markup=rating_markup
+    )
+    return ESPRESSO_AFTERTASTE
+
+async def prompt_espresso_comment(update: Update, context: ContextTypes.DEFAULT_TYPE):
+    """–ü–æ–∫–∞–∑–∞—Ç—å –≤–≤–æ–¥ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–ª—è —ç—Å–ø—Ä–µ—Å—Å–æ/—Ñ–∏–ª—å—Ç—Ä–∞."""
+    cancel_keyboard = [["-"], [BACK_BUTTON], ["‚ùå –û—Ç–º–µ–Ω–∞"]]
+    await update.message.reply_text(
+        "–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ '-' –µ—Å–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–µ –Ω—É–∂–µ–Ω):",
+        reply_markup=ReplyKeyboardMarkup(cancel_keyboard, resize_keyboard=True)
+    )
+    return ESPRESSO_COMMENT
+
+async def prompt_milk_drink_type(update: Update, context: ContextTypes.DEFAULT_TYPE):
+    """–ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±–æ—Ä —Ç–∏–ø–∞ –º–æ–ª–æ—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞."""
+    keyboard = [["–ö–∞–ø—É—á–∏–Ω–æ", "–§–ª—ç—Ç –£–∞–π—Ç"], [BACK_BUTTON], ["‚ùå –û—Ç–º–µ–Ω–∞"]]
+    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
+    
+    await update.message.reply_text(
+        "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –º–æ–ª–æ—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞:",
+        reply_markup=reply_markup
+    )
+    return MILK_DRINK_TYPE
+
+async def prompt_milk_balance(update: Update, context: ContextTypes.DEFAULT_TYPE):
+    """–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ü–µ–Ω–∫—É –±–∞–ª–∞–Ω—Å–∞ –º–æ–ª–æ—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞."""
+    drink_type = context.user_data.get('drink_type', '')
+    await update.message.reply_text(
+        f"ü•õ {drink_type}\n\n–û—Ü–µ–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –≤–∫—É—Å–∞ (1-5):\n"
+        "1 - –ù–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π\n5 - –ò–¥–µ–∞–ª—å–Ω–æ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π",
+        reply_markup=rating_markup
+    )
+    return MILK_BALANCE
+
+async def prompt_milk_bouquet(update: Update, context: ContextTypes.DEFAULT_TYPE):
+    """–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ü–µ–Ω–∫—É –±—É–∫–µ—Ç–∞ –º–æ–ª–æ—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞."""
+    await update.message.reply_text(
+        "–û—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –±—É–∫–µ—Ç–∞ (1-5):\n"
+        "1 - –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ \n5 - –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
+        reply_markup=rating_markup
+    )
+    return MILK_BOUQUET
+
+async def prompt_milk_foam(update: Update, context: ContextTypes.DEFAULT_TYPE):
+    """–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ü–µ–Ω–∫—É –ø–µ–Ω—ã –º–æ–ª–æ—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞."""
+    await update.message.reply_text(
+        "–û—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–µ–Ω—ã (1-5):\n"
+        "1 - –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ \n5 - –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
+        reply_markup=rating_markup
+    )
+    return MILK_FOAM
+
+async def prompt_milk_latte_art(update: Update, context: ContextTypes.DEFAULT_TYPE):
+    """–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ü–µ–Ω–∫—É –ª–∞—Ç—Ç–µ-–∞—Ä—Ç–∞."""
+    await update.message.reply_text(
+        "–û—Ü–µ–Ω–∏—Ç–µ –ª–∞—Ç—Ç–µ-–∞—Ä—Ç (1-5):\n"
+        "1 - –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ \n5 - –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
+        reply_markup=rating_markup
+    )
+    return MILK_LATTE_ART
+
+async def prompt_milk_photo(update: Update, context: ContextTypes.DEFAULT_TYPE):
+    """–ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–ø—Ä–æ—Å —Ñ–æ—Ç–æ –º–æ–ª–æ—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞."""
+    cancel_keyboard = [["-"], [BACK_BUTTON], ["‚ùå –û—Ç–º–µ–Ω–∞"]]
+    await update.message.reply_text(
+        "–î–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –Ω–∞–ø–∏—Ç–∫–∞ (–∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ '-' —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å):",
+        reply_markup=ReplyKeyboardMarkup(cancel_keyboard, resize_keyboard=True)
+    )
+    return MILK_PHOTO
+
+async def prompt_milk_comment(update: Update, context: ContextTypes.DEFAULT_TYPE, with_success: bool = False):
+    """–ü–æ–∫–∞–∑–∞—Ç—å –≤–≤–æ–¥ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–ª—è –º–æ–ª–æ—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞."""
+    cancel_keyboard = [["-"], [BACK_BUTTON], ["‚ùå –û—Ç–º–µ–Ω–∞"]]
+    text = "–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ '-' –µ—Å–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–µ –Ω—É–∂–µ–Ω):"
+    if with_success:
+        text = "‚úÖ –§–æ—Ç–æ –ø–æ–ª—É—á–µ–Ω–æ!\n\n" + text
+    await update.message.reply_text(
+        text,
+        reply_markup=ReplyKeyboardMarkup(cancel_keyboard, resize_keyboard=True)
+    )
+    return MILK_COMMENT
+
 async def start_review(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–ù–∞—á–∞–ª–æ –æ—Ü–µ–Ω–∫–∏ –Ω–∞–ø–∏—Ç–∫–∞"""
-    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø - —Ç–æ–ª—å–∫–æ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∏ –º–æ–≥—É—Ç –æ—Ü–µ–Ω–∏–≤–∞—Ç—å
-    if not is_mentor(update):
+    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø - –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∏ –∏ —Å—Ç–∞—Ä—à–∏–µ –º–æ–≥—É—Ç –æ—Ü–µ–Ω–∏–≤–∞—Ç—å
+    if not is_senior_or_mentor(update):
         await update.message.reply_text(
             "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.\n"
-            "–û—Ü–µ–Ω–∏–≤–∞—Ç—å –Ω–∞–ø–∏—Ç–∫–∏ –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∏."
+            "–û—Ü–µ–Ω–∏–≤–∞—Ç—å –Ω–∞–ø–∏—Ç–∫–∏ –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∏ –∏ —Å—Ç–∞—Ä—à–∏–µ."
         )
         return ConversationHandler.END
     
     context.user_data.clear()
     
     # –ü–æ–ª—É—á–∞–µ–º –±–∞—Ä–∏—Å—Ç–∞ –∏–∑ –ë–î
     barista_users = get_users_by_role('barista', active_only=True)
     baristas = [barista.name for barista in barista_users]
     
     # –ï—Å–ª–∏ –≤ –ë–î –Ω–µ—Ç –±–∞—Ä–∏—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º config.py –∫–∞–∫ fallback
     if not baristas:
         baristas = [barista['name'] for barista in BotConfig.baristas]
     
     keyboard = [[barista] for barista in baristas]
+    keyboard.append([BACK_BUTTON])
     keyboard.append(["‚ùå –û—Ç–º–µ–Ω–∞"])
     reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
     
     await update.message.reply_text(
         "–í—ã–±–µ—Ä–∏—Ç–µ –±–∞—Ä–∏—Å—Ç–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏:",
         reply_markup=reply_markup
     )
     return SELECTING_BARISTA
 
 async def select_barista(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–í—ã–±–æ—Ä –±–∞—Ä–∏—Å—Ç–∞"""
     barista_name = update.message.text
     
     if barista_name == "‚ùå –û—Ç–º–µ–Ω–∞":
         return await cancel_conversation(update, context)
     
+    if barista_name == BACK_BUTTON:
+        return await cancel_conversation(update, context)
+    
     # –ü–æ–ª—É—á–∞–µ–º –±–∞—Ä–∏—Å—Ç–∞ –∏–∑ –ë–î
     barista_users = get_users_by_role('barista', active_only=True)
     barista_names = [barista.name for barista in barista_users]
     
     # –ï—Å–ª–∏ –≤ –ë–î –Ω–µ—Ç –±–∞—Ä–∏—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º config.py –∫–∞–∫ fallback
     if not barista_names:
         barista_names = [barista['name'] for barista in BotConfig.baristas]
     
     if barista_name not in barista_names:
         await update.message.reply_text("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –±–∞—Ä–∏—Å—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞:")
         return SELECTING_BARISTA
     
     context.user_data['barista'] = barista_name
     
-    keyboard = [[point] for point in BotConfig.points]
-    keyboard.append(["‚ùå –û—Ç–º–µ–Ω–∞"])
-    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
-    
-    await update.message.reply_text(
-        f"‚úÖ –ë–∞—Ä–∏—Å—Ç–∞: {barista_name}\n\n–¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—á–∫—É:",
-        reply_markup=reply_markup
-    )
-    return SELECTING_POINT
+    return await prompt_point_selection(update, context)
 
 async def select_point(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–í—ã–±–æ—Ä —Ç–æ—á–∫–∏"""
     point = update.message.text
     
     if point == "‚ùå –û—Ç–º–µ–Ω–∞":
         return await cancel_conversation(update, context)
     
+    if point == BACK_BUTTON:
+        return await start_review(update, context)
+    
     if point not in BotConfig.points:
         await update.message.reply_text("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—á–∫—É –∏–∑ —Å–ø–∏—Å–∫–∞:")
         return SELECTING_POINT
     
     context.user_data['point'] = point
     
-    keyboard = [["–≠—Å–ø—Ä–µ—Å—Å–æ/–§–∏–ª—å—Ç—Ä"], ["–ú–æ–ª–æ—á–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫"]]
-    keyboard.append(["‚ùå –û—Ç–º–µ–Ω–∞"])
-    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
-    
-    await update.message.reply_text(
-        f"‚úÖ –¢–æ—á–∫–∞: {point}\n\n–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –Ω–∞–ø–∏—Ç–∫–∞:",
-        reply_markup=reply_markup
-    )
-    return SELECTING_CATEGORY
+    return await prompt_category_selection(update, context)
 
 async def select_category(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞–ø–∏—Ç–∫–∞ - –ø–µ—Ä–µ—Ö–æ–¥ –∫ –¥–µ—Ç–∞–ª—å–Ω–æ–π –æ—Ü–µ–Ω–∫–µ"""
     category = update.message.text
     
     if category == "‚ùå –û—Ç–º–µ–Ω–∞":
         return await cancel_conversation(update, context)
     
+    if category == BACK_BUTTON:
+        return await prompt_point_selection(update, context)
+    
     valid_categories = ["–≠—Å–ø—Ä–µ—Å—Å–æ/–§–∏–ª—å—Ç—Ä", "–ú–æ–ª–æ—á–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫"]
     if category not in valid_categories:
         await update.message.reply_text("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∑ —Å–ø–∏—Å–∫–∞:")
         return SELECTING_CATEGORY
     
     context.user_data['category'] = category
     
     # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –≤–µ—Ç–∫–µ –æ—Ü–µ–Ω–∫–∏
     if category == "–≠—Å–ø—Ä–µ—Å—Å–æ/–§–∏–ª—å—Ç—Ä":
         return await start_espresso_evaluation(update, context)
     else:  # –ú–æ–ª–æ—á–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫
         return await start_milk_evaluation(update, context)
 
 async def start_espresso_evaluation(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–ù–∞—á–∞–ª–æ –æ—Ü–µ–Ω–∫–∏ —ç—Å–ø—Ä–µ—Å—Å–æ/—Ñ–∏–ª—å—Ç—Ä–∞"""
-    keyboard = [["–≠—Å–ø—Ä–µ—Å—Å–æ", "–§–∏–ª—å—Ç—Ä"], ["‚ùå –û—Ç–º–µ–Ω–∞"]]
-    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
-    
-    await update.message.reply_text(
-        "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞–ø–∏—Ç–∫–∞:",
-        reply_markup=reply_markup
-    )
-    return ESPRESSO_DRINK_TYPE
+    return await prompt_espresso_drink_type(update, context)
 
 async def select_espresso_drink_type(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–í—ã–±–æ—Ä —Ç–∏–ø–∞ —ç—Å–ø—Ä–µ—Å—Å–æ/—Ñ–∏–ª—å—Ç—Ä–∞"""
     drink_type = update.message.text
     
     if drink_type == "‚ùå –û—Ç–º–µ–Ω–∞":
         return await cancel_conversation(update, context)
     
-    valid_types = ["–≠—Å–ø—Ä–µ—Å—Å–æ", "–§–∏–ª—å—Ç—Ä"]
+    if drink_type == BACK_BUTTON:
+        return await prompt_category_selection(update, context)
+    
+    valid_types = ["–≠—Å–ø—Ä–µ—Å—Å–æ", "–§–∏–ª—å—Ç—Ä", "–ê–ª—å—Ç."]
     if drink_type not in valid_types:
         await update.message.reply_text("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞–ø–∏—Ç–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞:")
         return ESPRESSO_DRINK_TYPE
     
     context.user_data['drink_type'] = drink_type
     
-    await update.message.reply_text(
-        f"‚òï {drink_type}\n\n–û—Ü–µ–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –≤–∫—É—Å–∞ (1-5):\n"
-        "1 - –ù–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π\n5 - –ò–¥–µ–∞–ª—å–Ω–æ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π",
-        reply_markup=rating_markup
-    )
-    return ESPRESSO_BALANCE
+    return await prompt_espresso_balance(update, context)
 
 async def select_espresso_balance(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–û—Ü–µ–Ω–∫–∞ –±–∞–ª–∞–Ω—Å–∞ —ç—Å–ø—Ä–µ—Å—Å–æ/—Ñ–∏–ª—å—Ç—Ä–∞"""
     balance = update.message.text
     
     if balance == "‚ùå –û—Ç–º–µ–Ω–∞":
         return await cancel_conversation(update, context)
     
+    if balance == BACK_BUTTON:
+        return await prompt_espresso_drink_type(update, context)
+    
     if balance not in ['1', '2', '3', '4', '5']:
         await update.message.reply_text("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:")
         return ESPRESSO_BALANCE
     
     context.user_data['balance'] = int(balance)
     
-    await update.message.reply_text(
-        "–û—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –±—É–∫–µ—Ç–∞ (1-5):\n"
-        "1 - –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ \n5 - –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
-        reply_markup=rating_markup
-    )
-    return ESPRESSO_BOUQUET
+    return await prompt_espresso_bouquet(update, context)
 
 async def select_espresso_bouquet(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–û—Ü–µ–Ω–∫–∞ –±—É–∫–µ—Ç–∞ —ç—Å–ø—Ä–µ—Å—Å–æ/—Ñ–∏–ª—å—Ç—Ä–∞"""
     bouquet = update.message.text
     
     if bouquet == "‚ùå –û—Ç–º–µ–Ω–∞":
         return await cancel_conversation(update, context)
     
+    if bouquet == BACK_BUTTON:
+        return await prompt_espresso_balance(update, context)
+    
     if bouquet not in ['1', '2', '3', '4', '5']:
         await update.message.reply_text("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:")
         return ESPRESSO_BOUQUET
     
     context.user_data['bouquet'] = int(bouquet)
     
-    await update.message.reply_text(
-        "–û—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ç–µ–ª–∞ –Ω–∞–ø–∏—Ç–∫–∞ (1-5):\n"
-        "1 - –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ \n5 - –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
-        reply_markup=rating_markup
-    )
-    return ESPRESSO_BODY
+    return await prompt_espresso_body(update, context)
 
 async def select_espresso_body(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–û—Ü–µ–Ω–∫–∞ —Ç–µ–ª–∞ —ç—Å–ø—Ä–µ—Å—Å–æ/—Ñ–∏–ª—å—Ç—Ä–∞"""
     body = update.message.text
     
     if body == "‚ùå –û—Ç–º–µ–Ω–∞":
         return await cancel_conversation(update, context)
     
+    if body == BACK_BUTTON:
+        return await prompt_espresso_bouquet(update, context)
+    
     if body not in ['1', '2', '3', '4', '5']:
         await update.message.reply_text("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:")
         return ESPRESSO_BODY
     
     context.user_data['body'] = int(body)
     
-    await update.message.reply_text(
-        "–û—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ—Å–ª–µ–≤–∫—É—Å–∏—è (1-5):\n"
-        "1 - –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ \n5 - –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
-        reply_markup=rating_markup
-    )
-    return ESPRESSO_AFTERTASTE
+    return await prompt_espresso_aftertaste(update, context)
 
 async def select_espresso_aftertaste(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–û—Ü–µ–Ω–∫–∞ –ø–æ—Å–ª–µ–≤–∫—É—Å–∏—è —ç—Å–ø—Ä–µ—Å—Å–æ/—Ñ–∏–ª—å—Ç—Ä–∞"""
     aftertaste = update.message.text
     
     if aftertaste == "‚ùå –û—Ç–º–µ–Ω–∞":
         return await cancel_conversation(update, context)
     
+    if aftertaste == BACK_BUTTON:
+        return await prompt_espresso_body(update, context)
+    
     if aftertaste not in ['1', '2', '3', '4', '5']:
         await update.message.reply_text("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:")
         return ESPRESSO_AFTERTASTE
     
     context.user_data['aftertaste'] = int(aftertaste)
     
-    cancel_keyboard = [["-"], ["‚ùå –û—Ç–º–µ–Ω–∞"]]
-    await update.message.reply_text(
-        "–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ '-' –µ—Å–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–µ –Ω—É–∂–µ–Ω):",
-        reply_markup=ReplyKeyboardMarkup(cancel_keyboard, resize_keyboard=True)
-    )
-    return ESPRESSO_COMMENT
+    return await prompt_espresso_comment(update, context)
 
 async def select_espresso_comment(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è —ç—Å–ø—Ä–µ—Å—Å–æ/—Ñ–∏–ª—å—Ç—Ä–∞"""
     comment = update.message.text
     
     if comment == "‚ùå –û—Ç–º–µ–Ω–∞":
         return await cancel_conversation(update, context)
     
+    if comment == BACK_BUTTON:
+        return await prompt_espresso_aftertaste(update, context)
+    
     context.user_data['comment'] = comment
     
     # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ü–µ–Ω–∫—É
     await save_review_data(update, context)
     return ConversationHandler.END
 
 async def start_milk_evaluation(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–ù–∞—á–∞–ª–æ –æ—Ü–µ–Ω–∫–∏ –º–æ–ª–æ—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞"""
-    keyboard = [["–ö–∞–ø—É—á–∏–Ω–æ", "–§–ª—ç—Ç –£–∞–π—Ç"], ["‚ùå –û—Ç–º–µ–Ω–∞"]]
-    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
-    
-    await update.message.reply_text(
-        "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –º–æ–ª–æ—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞:",
-        reply_markup=reply_markup
-    )
-    return MILK_DRINK_TYPE
+    return await prompt_milk_drink_type(update, context)
 
 async def select_milk_drink_type(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–í—ã–±–æ—Ä —Ç–∏–ø–∞ –º–æ–ª–æ—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞"""
     drink_type = update.message.text
     
     if drink_type == "‚ùå –û—Ç–º–µ–Ω–∞":
         return await cancel_conversation(update, context)
     
+    if drink_type == BACK_BUTTON:
+        return await prompt_category_selection(update, context)
+    
     valid_types = ["–ö–∞–ø—É—á–∏–Ω–æ", "–§–ª—ç—Ç –£–∞–π—Ç"]
     if drink_type not in valid_types:
         await update.message.reply_text("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞–ø–∏—Ç–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞:")
         return MILK_DRINK_TYPE
     
     context.user_data['drink_type'] = drink_type
     
-    await update.message.reply_text(
-        f"ü•õ {drink_type}\n\n–û—Ü–µ–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –≤–∫—É—Å–∞ (1-5):\n"
-        "1 - –ù–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π\n5 - –ò–¥–µ–∞–ª—å–Ω–æ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π",
-        reply_markup=rating_markup
-    )
-    return MILK_BALANCE
+    return await prompt_milk_balance(update, context)
 
 async def select_milk_balance(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–û—Ü–µ–Ω–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –º–æ–ª–æ—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞"""
     balance = update.message.text
     
     if balance == "‚ùå –û—Ç–º–µ–Ω–∞":
         return await cancel_conversation(update, context)
     
+    if balance == BACK_BUTTON:
+        return await prompt_milk_drink_type(update, context)
+    
     if balance not in ['1', '2', '3', '4', '5']:
         await update.message.reply_text("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:")
         return MILK_BALANCE
     
     context.user_data['balance'] = int(balance)
     
-    await update.message.reply_text(
-        "–û—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –±—É–∫–µ—Ç–∞ (1-5):\n"
-        "1 - –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ \n5 - –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
-        reply_markup=rating_markup
-    )
-    return MILK_BOUQUET
+    return await prompt_milk_bouquet(update, context)
 
 async def select_milk_bouquet(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–û—Ü–µ–Ω–∫–∞ –±—É–∫–µ—Ç–∞ –º–æ–ª–æ—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞"""
     bouquet = update.message.text
     
     if bouquet == "‚ùå –û—Ç–º–µ–Ω–∞":
         return await cancel_conversation(update, context)
     
+    if bouquet == BACK_BUTTON:
+        return await prompt_milk_balance(update, context)
+    
     if bouquet not in ['1', '2', '3', '4', '5']:
         await update.message.reply_text("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:")
         return MILK_BOUQUET
     
     context.user_data['bouquet'] = int(bouquet)
     
-    await update.message.reply_text(
-        "–û—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–µ–Ω—ã (1-5):\n"
-        "1 - –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ \n5 - –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
-        reply_markup=rating_markup
-    )
-    return MILK_FOAM
+    return await prompt_milk_foam(update, context)
 
 async def select_milk_foam(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–û—Ü–µ–Ω–∫–∞ –ø–µ–Ω—ã –º–æ–ª–æ—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞"""
     foam = update.message.text
     
     if foam == "‚ùå –û—Ç–º–µ–Ω–∞":
         return await cancel_conversation(update, context)
     
+    if foam == BACK_BUTTON:
+        return await prompt_milk_bouquet(update, context)
+    
     if foam not in ['1', '2', '3', '4', '5']:
         await update.message.reply_text("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:")
         return MILK_FOAM
     
     context.user_data['foam'] = int(foam)
     
-    await update.message.reply_text(
-        "–û—Ü–µ–Ω–∏—Ç–µ –ª–∞—Ç—Ç–µ-–∞—Ä—Ç (1-5):\n"
-        "1 - –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ \n5 - –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
-        reply_markup=rating_markup
-    )
-    return MILK_LATTE_ART
+    return await prompt_milk_latte_art(update, context)
 
 async def select_milk_latte_art(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–û—Ü–µ–Ω–∫–∞ –ª–∞—Ç—Ç–µ-–∞—Ä—Ç–∞"""
     latte_art = update.message.text
     
     if latte_art == "‚ùå –û—Ç–º–µ–Ω–∞":
         return await cancel_conversation(update, context)
     
+    if latte_art == BACK_BUTTON:
+        return await prompt_milk_foam(update, context)
+    
     if latte_art not in ['1', '2', '3', '4', '5']:
         await update.message.reply_text("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:")
         return MILK_LATTE_ART
     
     context.user_data['latte_art'] = int(latte_art)
     
-    cancel_keyboard = [["-"], ["‚ùå –û—Ç–º–µ–Ω–∞"]]
-    await update.message.reply_text(
-        "–î–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –Ω–∞–ø–∏—Ç–∫–∞ (–∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ '-' —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å):",
-        reply_markup=ReplyKeyboardMarkup(cancel_keyboard, resize_keyboard=True)
-    )
-    return MILK_PHOTO
+    return await prompt_milk_photo(update, context)
 
 async def select_milk_photo(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ –º–æ–ª–æ—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞ —á–µ—Ä–µ–∑ Telegram file_id"""
     if update.message.text == "‚ùå –û—Ç–º–µ–Ω–∞":
         return await cancel_conversation(update, context)
     
+    if update.message.text == BACK_BUTTON:
+        return await prompt_milk_latte_art(update, context)
+    
     if update.message.text == "-":
         context.user_data['photo_file_id'] = None
-        cancel_keyboard = [["-"], ["‚ùå –û—Ç–º–µ–Ω–∞"]]
-        await update.message.reply_text(
-            "–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ '-' –µ—Å–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–µ –Ω—É–∂–µ–Ω):",
-            reply_markup=ReplyKeyboardMarkup(cancel_keyboard, resize_keyboard=True)
-        )
-        return MILK_COMMENT
+        return await prompt_milk_comment(update, context)
     elif update.message.photo:
         try:
             # –ü–æ–ª—É—á–∞–µ–º file_id —Å–∞–º–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ —Ñ–æ—Ç–æ (–ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç –≤ —Å–ø–∏—Å–∫–µ)
             photo_file_id = update.message.photo[-1].file_id
             
             # –°–æ—Ö—Ä–∞–Ω—è–µ–º file_id
             context.user_data['photo_file_id'] = photo_file_id
             
-            cancel_keyboard = [["-"], ["‚ùå –û—Ç–º–µ–Ω–∞"]]
-            await update.message.reply_text(
-                "‚úÖ –§–æ—Ç–æ –ø–æ–ª—É—á–µ–Ω–æ!\n\n–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ '-' –µ—Å–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–µ –Ω—É–∂–µ–Ω):",
-                reply_markup=ReplyKeyboardMarkup(cancel_keyboard, resize_keyboard=True)
-            )
-            return MILK_COMMENT
+            return await prompt_milk_comment(update, context, with_success=True)
             
         except Exception as e:
-            cancel_keyboard = [["-"], ["‚ùå –û—Ç–º–µ–Ω–∞"]]
+            cancel_keyboard = [["-"], [BACK_BUTTON], ["‚ùå –û—Ç–º–µ–Ω–∞"]]
             await update.message.reply_text(
                 f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–æ—Ç–æ: {str(e)}\n\n"
                 "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ '-' —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å:",
                 reply_markup=ReplyKeyboardMarkup(cancel_keyboard, resize_keyboard=True)
             )
             return MILK_PHOTO
     else:
-        cancel_keyboard = [["-"], ["‚ùå –û—Ç–º–µ–Ω–∞"]]
+        cancel_keyboard = [["-"], [BACK_BUTTON], ["‚ùå –û—Ç–º–µ–Ω–∞"]]
         await update.message.reply_text(
             "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –∏–ª–∏ '-' —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å:",
             reply_markup=ReplyKeyboardMarkup(cancel_keyboard, resize_keyboard=True)
         )
         return MILK_PHOTO
 
 async def select_milk_comment(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –º–æ–ª–æ—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞"""
     comment = update.message.text
     
     if comment == "‚ùå –û—Ç–º–µ–Ω–∞":
         return await cancel_conversation(update, context)
     
+    if comment == BACK_BUTTON:
+        return await prompt_milk_photo(update, context)
+    
     context.user_data['comment'] = comment
     
     # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ü–µ–Ω–∫—É
     await save_review_data(update, context)
     return ConversationHandler.END
 
 async def save_review_data(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"""
     data = context.user_data
     respondent_name = update.effective_user.first_name
     
     # –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
     review_data = {
         'respondent_name': respondent_name,
         'barista_name': data['barista'],
         'point': data['point'],
         'category': data['category'],
         'drink_type': data.get('drink_type'),
         'balance': data.get('balance'),
         'bouquet': data.get('bouquet'),
         'body': data.get('body'),
         'aftertaste': data.get('aftertaste'),
         'foam': data.get('foam'),
         'latte_art': data.get('latte_art'),
         'photo_file_id': data.get('photo_file_id'),  # üÜï –°–æ—Ö—Ä–∞–Ω—è–µ–º file_id –≤–º–µ—Å—Ç–æ –ø—É—Ç–∏
@@ -500,26 +615,26 @@ def get_review_conversation_handler():
             SELECTING_CATEGORY: [MessageHandler(filters.TEXT & ~filters.COMMAND, select_category)],
             
             # –í–µ—Ç–∫–∞ —ç—Å–ø—Ä–µ—Å—Å–æ/—Ñ–∏–ª—å—Ç—Ä–∞
             ESPRESSO_DRINK_TYPE: [MessageHandler(filters.TEXT & ~filters.COMMAND, select_espresso_drink_type)],
             ESPRESSO_BALANCE: [MessageHandler(filters.TEXT & ~filters.COMMAND, select_espresso_balance)],
             ESPRESSO_BOUQUET: [MessageHandler(filters.TEXT & ~filters.COMMAND, select_espresso_bouquet)],
             ESPRESSO_BODY: [MessageHandler(filters.TEXT & ~filters.COMMAND, select_espresso_body)],
             ESPRESSO_AFTERTASTE: [MessageHandler(filters.TEXT & ~filters.COMMAND, select_espresso_aftertaste)],
             ESPRESSO_COMMENT: [MessageHandler(filters.TEXT & ~filters.COMMAND, select_espresso_comment)],
             
             # –í–µ—Ç–∫–∞ –º–æ–ª–æ—á–Ω—ã—Ö –Ω–∞–ø–∏—Ç–∫–æ–≤
             MILK_DRINK_TYPE: [MessageHandler(filters.TEXT & ~filters.COMMAND, select_milk_drink_type)],
             MILK_BALANCE: [MessageHandler(filters.TEXT & ~filters.COMMAND, select_milk_balance)],
             MILK_BOUQUET: [MessageHandler(filters.TEXT & ~filters.COMMAND, select_milk_bouquet)],
             MILK_FOAM: [MessageHandler(filters.TEXT & ~filters.COMMAND, select_milk_foam)],
             MILK_LATTE_ART: [MessageHandler(filters.TEXT & ~filters.COMMAND, select_milk_latte_art)],
             MILK_PHOTO: [MessageHandler(filters.TEXT | filters.PHOTO, select_milk_photo)],
             MILK_COMMENT: [MessageHandler(filters.TEXT & ~filters.COMMAND, select_milk_comment)],
         },
         fallbacks=[
             CommandHandler("cancel", cancel_conversation),
             CommandHandler("start", start_cancel_conversation),
             MessageHandler(filters.Regex("^‚ùå –û—Ç–º–µ–Ω–∞$"), cancel_conversation),
         ],
         allow_reentry=True
-    )
\ No newline at end of file
+    )
diff --git a/bot/handlers/settings.py b/bot/handlers/settings.py
index 63959162b4f1b1a4dd810e4e48ad530f4619fc44..29b15963abfb85b3ec3e612971ee2c8cfbce12a3 100644
--- a/bot/handlers/settings.py
+++ b/bot/handlers/settings.py
@@ -1,35 +1,36 @@
 """–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫"""
 from telegram import Update, ReplyKeyboardMarkup, KeyboardButton, InlineKeyboardButton, InlineKeyboardMarkup
 from telegram.ext import ContextTypes, ConversationHandler, MessageHandler, filters, CommandHandler, CallbackQueryHandler
 from bot.utils.auth import require_roles, ROLE_MENTOR, ROLE_SENIOR
 from bot.database.user_operations import (
     get_all_users, create_user, update_user, delete_user, get_user_by_id, get_user_by_iiko_id
 )
 from bot.database.schedule_operations import (
     get_upcoming_shifts_by_iiko_id, get_shifts_by_iiko_id,
     create_shift, update_shift, get_shift_by_id, bulk_create_shifts, delete_shifts_by_date_range,
+    remove_stale_shifts,
     create_shift_type, get_shift_types, update_shift_type, delete_shift_type, get_shift_type_by_id
 )
 from bot.database.checklist_operations import get_hybrid_assignment_tasks
 from bot.utils.google_sheets import get_current_month_name, get_next_month_name, parse_schedule_from_sheet
 from bot.utils.common_handlers import cancel_conversation, start_cancel_conversation
 from bot.utils.emulation import is_emulation_mode, stop_emulation, start_emulation, get_emulated_user
 from bot.keyboards.menus import get_main_menu
 import sqlite3
 import os
 from datetime import datetime, date, timedelta
 import logging
 
 logger = logging.getLogger(__name__)
 
 # –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
 (SETTINGS_MENU, ADDING_USER_NAME, ADDING_USER_IIKO_ID, ADDING_USER_USERNAME, ADDING_USER_ROLE,
  EDITING_USER_NAME, EDITING_USER_ROLE, EDITING_USER_IIKO_ID, EDITING_USER_USERNAME,
  DELETING_USER_CONFIRM, CLEARING_REVIEWS,
  # –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
  SCHEDULE_MENU, PARSING_MONTH, SELECTING_EMPLOYEE_FOR_SHIFTS, VIEWING_SHIFTS,
  ADDING_SHIFT_DATE, ADDING_SHIFT_IIKO_ID, ADDING_SHIFT_POINT, ADDING_SHIFT_TYPE,
  ADDING_SHIFT_START, ADDING_SHIFT_END, EDITING_SHIFT_ID, EDITING_SHIFT_FIELD,
  EDITING_SHIFT_MENU, EDITING_SHIFT_DATE, EDITING_SHIFT_IIKO_ID, 
  EDITING_SHIFT_POINT, EDITING_SHIFT_TYPE, EDITING_SHIFT_TIME,
  EMULATION_MANAGEMENT, EMULATING_USER, EMULATION_MENU, DELETING_SHIFT_CONFIRM,
@@ -775,85 +776,85 @@ async def schedule_management(update: Update, context: ContextTypes.DEFAULT_TYPE
         [KeyboardButton("‚ûï –ù–∞–∑–Ω–∞—á–∏—Ç—å —Å–º–µ–Ω—É –≤—Ä—É—á–Ω—É—é")],
         [KeyboardButton("‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å —Å–º–µ–Ω—É –ø–æ ID")],
         [KeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥")]
     ]
     reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
     
     await update.message.reply_text(
         "üìÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º\n\n"
         "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
         reply_markup=reply_markup
     )
     return SCHEDULE_MENU
 
 async def parse_current_month(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–ü–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞"""
     await update.message.reply_text("üîÑ –ù–∞—á–∏–Ω–∞—é –ø–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞...")
     
     try:
         month_name = get_current_month_name()
         shifts_data = parse_schedule_from_sheet(month_name)
         
         if not shifts_data:
             await update.message.reply_text(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è {month_name}")
             return await schedule_management(update, context)
         
-        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–º–µ–Ω—ã —ç—Ç–æ–≥–æ –º–µ—Å—è—Ü–∞
+        # –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Å–º–µ–Ω—ã, —Å–æ—Ö—Ä–∞–Ω—è—è —Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ
         first_date = min(s['shift_date'] for s in shifts_data)
         last_date = max(s['shift_date'] for s in shifts_data)
-        delete_shifts_by_date_range(first_date, last_date)
+        remove_stale_shifts(shifts_data, first_date, last_date)
         
         # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ —Å–º–µ–Ω—ã
         created_count = bulk_create_shifts(shifts_data)
         
         await update.message.reply_text(
             f"‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω!\n"
             f"–ú–µ—Å—è—Ü: {month_name}\n"
             f"–°–æ–∑–¥–∞–Ω–æ/–æ–±–Ω–æ–≤–ª–µ–Ω–æ —Å–º–µ–Ω: {created_count}"
         )
     except Exception as e:
         logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞: {e}")
         await update.message.reply_text(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ: {str(e)}")
     
     return await schedule_management(update, context)
 
 async def parse_next_month(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–ü–∞—Ä—Å–∏–Ω–≥ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞"""
     await update.message.reply_text("üîÑ –ù–∞—á–∏–Ω–∞—é –ø–∞—Ä—Å–∏–Ω–≥ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞...")
     
     try:
         month_name = get_next_month_name()
         shifts_data = parse_schedule_from_sheet(month_name)
         
         if not shifts_data:
             await update.message.reply_text(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è {month_name}")
             return await schedule_management(update, context)
         
-        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–º–µ–Ω—ã —ç—Ç–æ–≥–æ –º–µ—Å—è—Ü–∞
+        # –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Å–º–µ–Ω—ã, —Å–æ—Ö—Ä–∞–Ω—è—è —Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ
         first_date = min(s['shift_date'] for s in shifts_data)
         last_date = max(s['shift_date'] for s in shifts_data)
-        delete_shifts_by_date_range(first_date, last_date)
+        remove_stale_shifts(shifts_data, first_date, last_date)
         
         # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ —Å–º–µ–Ω—ã
         created_count = bulk_create_shifts(shifts_data)
         
         await update.message.reply_text(
             f"‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω!\n"
             f"–ú–µ—Å—è—Ü: {month_name}\n"
             f"–°–æ–∑–¥–∞–Ω–æ/–æ–±–Ω–æ–≤–ª–µ–Ω–æ —Å–º–µ–Ω: {created_count}"
         )
     except Exception as e:
         logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞: {e}")
         await update.message.reply_text(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ: {str(e)}")
     
     return await schedule_management(update, context)
 
 async def select_employee_for_shifts(update: Update, context: ContextTypes.DEFAULT_TYPE):
     """–í—ã–±–æ—Ä —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–º–µ–Ω"""
     users = get_all_users(active_only=True)
     users_with_iiko = [u for u in users if u.iiko_id]
     
     if not users_with_iiko:
         await update.message.reply_text("‚ùå –ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º iiko_id")
         return await schedule_management(update, context)
     
     keyboard = []
@@ -3653,26 +3654,26 @@ def get_settings_conversation_handler():
                 MessageHandler(filters.Regex("^‚¨ÖÔ∏è –ù–∞–∑–∞–¥$"), hybrid_management),
             ],
             HYBRID_EDIT_EXISTING: [
                 MessageHandler(filters.Regex("^‚¨ÖÔ∏è –ù–∞–∑–∞–¥$"), hybrid_management),
                 MessageHandler(filters.TEXT & ~filters.COMMAND, hybrid_edit_select),
                 
             ],
             HYBRID_DELETE_EXISTING: [
                 MessageHandler(filters.Regex("^‚¨ÖÔ∏è –ù–∞–∑–∞–¥$"), hybrid_management),
                 MessageHandler(filters.TEXT & ~filters.COMMAND, hybrid_delete_select),
             ],
             HYBRID_DELETE_CONFIRM: [
                 MessageHandler(filters.TEXT & ~filters.COMMAND, hybrid_delete_confirm),
             ],
             # –û—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
             CLEARING_REVIEWS: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_clear_reviews)],
         },
         fallbacks=[
             CommandHandler("cancel", cancel_conversation),
             CommandHandler("start", start_cancel_conversation),
             MessageHandler(filters.Regex("^‚ùå –û—Ç–º–µ–Ω–∞$"), cancel_conversation),
             CallbackQueryHandler(handle_user_callback, pattern="^(edit_user_|delete_user_|back_to_users_management)"),
             CallbackQueryHandler(handle_shift_type_callback, pattern="^(edit_shift_type_|delete_shift_type_|back_to_shift_types_management)"),
         ],
         allow_reentry=True
-    )
\ No newline at end of file
+    )
diff --git a/bot/main.py b/bot/main.py
index 1f439dcb947d491950703aef692aa7d0f7bd006a..5ee27376665d98a3ecb03f6cf760dcb014cb0428 100644
--- a/bot/main.py
+++ b/bot/main.py
@@ -129,51 +129,51 @@ class CoffeeBot:
                     greeting += "\n\nüìÖ –í–∞—à–∏ –±–ª–∏–∂–∞–π—à–∏–µ —Å–º–µ–Ω—ã –Ω–∞ –Ω–µ–¥–µ–ª—é:\n"
                     for shift in shifts:
                         if not shift.shift_type_obj:
                             continue
                         shift_type_names = {
                             'morning': 'üåÖ –£—Ç—Ä–æ',
                             'hybrid': 'üå§Ô∏è –ü–µ—Ä–µ—Å–º–µ–Ω',
                             'evening': 'üåÜ –í–µ—á–µ—Ä'
                         }
                         shift_type_text = shift_type_names.get(shift.shift_type_obj.shift_type, shift.shift_type_obj.shift_type)
                         date_str = shift.shift_date.strftime("%d.%m")
                         start_str = shift.shift_type_obj.start_time.strftime("%H:%M")
                         end_str = shift.shift_type_obj.end_time.strftime("%H:%M")
                         greeting += f"‚Ä¢ {date_str} ({shift_type_text}) {shift.shift_type_obj.point}: {start_str} - {end_str}\n"
                 else:
                     greeting += "\n\nüìÖ –ë–ª–∏–∂–∞–π—à–∏—Ö —Å–º–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
         else:
             greeting = f"–ü—Ä–∏–≤–µ—Ç, {user.first_name}! üëã\n\n‚ö†Ô∏è –í–∞—à –∞–∫–∫–∞—É–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."
         
         reply_markup = get_main_menu()
         await update.message.reply_text(
             greeting,
             reply_markup=reply_markup
         )
     
-    async def cancel_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
+    async def cancel_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
         """–ö–æ–º–∞–Ω–¥–∞ /cancel"""
         return await cancel_conversation(update, context)
         
     async def show_db_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
         """–ö–æ–º–∞–Ω–¥–∞ /show_db - –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
         try:
             conn = sqlite3.connect('coffee_quality.db')
             cursor = conn.cursor()
             cursor.execute("SELECT * FROM drink_reviews ORDER BY id DESC LIMIT 5")
             records = cursor.fetchall()
             conn.close()
             
             if not records:
                 await update.message.reply_text("üì≠ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞")
                 return
             
             response = "üìä –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∑–∞–ø–∏—Å–µ–π:\n\n"
             for record in records:
                 (id, respondent, barista, point, category, drink_type, 
                  balance, bouquet, body, aftertaste, foam, latte_art, 
                  photo_file_id, comment, created_at) = record
                 
                 response += f"üÜî ID: {id}\n"
                 response += f"üë§ –ù–∞—Å—Ç–∞–≤–Ω–∏–∫: {respondent}\n"
                 response += f"‚òï –ë–∞—Ä–∏—Å—Ç–∞: {barista}\n"
@@ -419,26 +419,26 @@ class CoffeeBot:
             
             shift_type_names = {
                 'morning': 'üåÖ –£—Ç—Ä–æ',
                 'hybrid': 'üå§Ô∏è –ü–µ—Ä–µ—Å–º–µ–Ω', 
                 'evening': 'üåÜ –í–µ—á–µ—Ä'
             }
         
             shift_type_text = shift_type_names.get(shift.shift_type_obj.shift_type, shift.shift_type_obj.shift_type)
             date_str = shift.shift_date.strftime("%d.%m.%Y")
             start_str = shift.shift_type_obj.start_time.strftime("%H:%M")
             end_str = shift.shift_type_obj.end_time.strftime("%H:%M")
         
             message += f"‚Ä¢ {date_str} ({shift_type_text})\n"
             message += f"  üè™ {shift.shift_type_obj.point}\n"
             message += f"  ‚è∞ {start_str} - {end_str}\n\n"
     
         await update.message.reply_text(message)
     
     def run(self):
         """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞"""
         print("üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞...")
         self.application.run_polling()
 
 if __name__ == "__main__":
     bot = CoffeeBot()
-    bot.run()
\ No newline at end of file
+    bot.run()
diff --git a/bot/utils/google_sheets.py b/bot/utils/google_sheets.py
index 9112eb07d7787e7432e90d7b20c322f931d40251..4c5a053cab5123c9789c81110e0d475292fba3c5 100644
--- a/bot/utils/google_sheets.py
+++ b/bot/utils/google_sheets.py
@@ -26,50 +26,58 @@ SPREADSHEET_ID = "1-NpGX3AfsBiOGHCBlCWD_6lTsCdMFIMiWgbkPVE0z0Q"
 SCOPES = [
     'https://www.googleapis.com/auth/spreadsheets',
     'https://www.googleapis.com/auth/drive'
 ]
 
 def get_google_client():
     """–ü–æ–ª—É—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç Google Sheets"""
     try:
         credentials_path = os.path.join(os.path.dirname(os.path.dirname(os.path.dirname(__file__))), 'credentials.json')
         if not os.path.exists(credentials_path):
             raise FileNotFoundError(f"–§–∞–π–ª credentials.json –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ –ø—É—Ç–∏: {credentials_path}")
         
         creds = Credentials.from_service_account_file(credentials_path, scopes=SCOPES)
         client = gspread.authorize(creds)
         return client
     except Exception as e:
         logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Google Sheets: {e}")
         raise
 
 def get_worksheet_by_month(client, month_name: str):
     """–ü–æ–ª—É—á–∏—Ç—å –ª–∏—Å—Ç –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –º–µ—Å—è—Ü–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–î–µ–∫–∞–±—Ä—å 24')"""
     try:
         spreadsheet = client.open_by_key(SPREADSHEET_ID)
         
         # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ª–∏—Å—Ç —Å —Ç–æ—á–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º
+        try:
+            uppercase_month_name = month_name.upper()
+            worksheet = spreadsheet.worksheet(uppercase_month_name)
+            logger.info(f"–ù–∞–π–¥–µ–Ω –ª–∏—Å—Ç —Å —Ç–æ—á–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º: {uppercase_month_name}")
+            return worksheet
+        except gspread.exceptions.WorksheetNotFound:
+            logger.warning(f"–õ–∏—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º '{uppercase_month_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç...")
+        
         try:
             worksheet = spreadsheet.worksheet(month_name)
             logger.info(f"–ù–∞–π–¥–µ–Ω –ª–∏—Å—Ç —Å —Ç–æ—á–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º: {month_name}")
             return worksheet
         except gspread.exceptions.WorksheetNotFound:
             logger.warning(f"–õ–∏—Å—Ç —Å —Ç–æ—á–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º '{month_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—â–µ–º –ø–æ—Ö–æ–∂–∏–µ...")
             
             # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ª–∏—Å—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—è—Ü–∞
             available_sheets = [sheet.title for sheet in spreadsheet.worksheets()]
             logger.info(f"–î–æ—Å—Ç—É–ø–Ω—ã–µ –ª–∏—Å—Ç—ã: {available_sheets}")
             
             # –ò—â–µ–º —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
             for sheet in spreadsheet.worksheets():
                 # –ü—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É –¥–ª—è –ø–æ–∏—Å–∫–∞
                 if month_name.lower() in sheet.title.lower():
                     logger.info(f"–ù–∞–π–¥–µ–Ω –ø–æ—Ö–æ–∂–∏–π –ª–∏—Å—Ç: {sheet.title}")
                     return sheet
             
             # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
             alternative_names = [
                 month_name.replace(" ", ""),  # "–ù–æ—è–±—Ä—å25"
                 month_name.replace("25", "2025"),  # "–ù–æ—è–±—Ä—å 2025"
                 month_name.split()[0]  # "–ù–æ—è–±—Ä—å"
             ]
             
@@ -311,59 +319,60 @@ def _normalize_time_format(time_str: str) -> str:
     try:
         parts = time_str.split(':')
         if len(parts) != 2:
             return time_str
             
         hour = parts[0].zfill(2)  # –î–æ–±–∞–≤–ª—è–µ–º –≤–µ–¥—É—â–∏–π –Ω–æ–ª—å –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
         minute = parts[1].zfill(2)
         
         return f"{hour}:{minute}"
     except:
         return time_str
 
 def get_current_month_name() -> str:
     """–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Ç–∞–±–ª–∏—Ü—ã"""
     now = datetime.now()
     month_names = {
         1: '–Ø–Ω–≤–∞—Ä—å', 2: '–§–µ–≤—Ä–∞–ª—å', 3: '–ú–∞—Ä—Ç', 4: '–ê–ø—Ä–µ–ª—å',
         5: '–ú–∞–π', 6: '–ò—é–Ω—å', 7: '–ò—é–ª—å', 8: '–ê–≤–≥—É—Å—Ç',
         9: '–°–µ–Ω—Ç—è–±—Ä—å', 10: '–û–∫—Ç—è–±—Ä—å', 11: '–ù–æ—è–±—Ä—å', 12: '–î–µ–∫–∞–±—Ä—å'
     }
     year = now.year % 100
     return f"{month_names[now.month]} {year}"
 
 def get_next_month_name() -> str:
     """–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Ç–∞–±–ª–∏—Ü—ã"""
-    next_month = datetime.now() + timedelta(days=32)
-    next_month = next_month.replace(day=1)
+    now = datetime.now()
+    next_month_number = 1 if now.month == 12 else now.month + 1
+    next_year = now.year + (1 if now.month == 12 else 0)
     month_names = {
         1: '–Ø–Ω–≤–∞—Ä—å', 2: '–§–µ–≤—Ä–∞–ª—å', 3: '–ú–∞—Ä—Ç', 4: '–ê–ø—Ä–µ–ª—å',
         5: '–ú–∞–π', 6: '–ò—é–Ω—å', 7: '–ò—é–ª—å', 8: '–ê–≤–≥—É—Å—Ç',
         9: '–°–µ–Ω—Ç—è–±—Ä—å', 10: '–û–∫—Ç—è–±—Ä—å', 11: '–ù–æ—è–±—Ä—å', 12: '–î–µ–∫–∞–±—Ä—å'
     }
-    year = next_month.year % 100
-    return f"{month_names[next_month.month]} {year}"
+    year = next_year % 100
+    return f"{month_names[next_month_number]} {year}"
 
 def get_sheet_client():
     """–ü–æ–ª—É—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Google Sheets (—Å –ø—Ä–∞–≤–∞–º–∏ –∑–∞–ø–∏—Å–∏)"""
     try:
         # –ò–°–ü–û–õ–¨–ó–£–ï–ú –¢–ï –ñ–ï SCOPES –ò CREDENTIALS, –ß–¢–û –ò –í get_google_client
         credentials_path = os.path.join(os.path.dirname(os.path.dirname(os.path.dirname(__file__))), 'credentials.json')
         if not os.path.exists(credentials_path):
             raise FileNotFoundError(f"–§–∞–π–ª credentials.json –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ –ø—É—Ç–∏: {credentials_path}")
         
         creds = Credentials.from_service_account_file(credentials_path, scopes=SCOPES)
         client = gspread.authorize(creds)
         return client
     except Exception as e:
         logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Google Sheets: {e}")
         raise
     
 def get_worksheet(month_name: str):
     """–ü–æ–ª—É—á–∏—Ç—å —Ä–∞–±–æ—á–∏–π –ª–∏—Å—Ç –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –º–µ—Å—è—Ü–∞"""
     try:
         client = get_sheet_client()
         spreadsheet = client.open_by_key(SPREADSHEET_ID)
         return spreadsheet.worksheet(month_name)
     except Exception as e:
         logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ª–∏—Å—Ç–∞ {month_name}: {e}")
         raise
@@ -618,26 +627,26 @@ def sync_swap_to_sheets(swap_data: Dict) -> bool:
             success = update_shift_in_sheets(
                 iiko_id=from_emp['iiko_id'],
                 shift_date=from_emp['old_shift'].shift_date,
                 start_time=None,
                 end_time=None,
                 point=None
             )
             results.append(success)
         
         # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–º–µ–Ω—É
         to_emp = swap_data['to_employee'] 
         if to_emp['new_shift'] and to_emp['new_shift'].shift_type_obj:
             success = update_shift_in_sheets(
                 iiko_id=to_emp['iiko_id'],
                 shift_date=to_emp['new_shift'].shift_date,
                 start_time=to_emp['new_shift'].shift_type_obj.start_time.strftime("%H:%M"),
                 end_time=to_emp['new_shift'].shift_type_obj.end_time.strftime("%H:%M"),
                 point=to_emp['new_shift'].shift_type_obj.point
             )
             results.append(success)
         
         return all(results)
         
     except Exception as e:
         logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∑–∞–º–µ–Ω—ã: {e}")
-        return False
\ No newline at end of file
+        return False
